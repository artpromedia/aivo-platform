{{!-- Progress Report Email Template --}}
{{!-- Sent periodically to parents with student progress updates --}}

{{#> layouts/base coppaNotice=true}}

<h1>{{t 'progress_report.title'}}</h1>

<p>{{t 'progress_report.greeting' parentName=parentName}}</p>

<p>{{t 'progress_report.intro' studentName=studentName periodName=periodName}}</p>

<!-- Overall Progress Card -->
<div style="background: linear-gradient(135deg, {{brandColor}}, {{brandColorDark}}); border-radius: 12px; padding: 24px; margin: 24px 0; color: #ffffff;">
  <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
    <tr>
      <td>
        <p style="margin: 0; font-size: 14px; opacity: 0.9;">{{t 'progress_report.overall_progress'}}</p>
        <p style="margin: 8px 0 0 0; font-size: 48px; font-weight: 700;">{{overallProgress}}%</p>
      </td>
      <td style="text-align: right; vertical-align: bottom;">
        {{#if progressTrend}}
        <span style="display: inline-block; padding: 6px 12px; background-color: rgba(255,255,255,0.2); border-radius: 20px; font-size: 14px;">
          {{#if (eq progressTrend 'up')}}ðŸ“ˆ +{{progressChange}}%{{/if}}
          {{#if (eq progressTrend 'down')}}ðŸ“‰ {{progressChange}}%{{/if}}
          {{#if (eq progressTrend 'stable')}}ðŸ“Š {{t 'progress_report.stable'}}{{/if}}
        </span>
        {{/if}}
      </td>
    </tr>
  </table>
</div>

<!-- Quick Stats -->
<table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="margin: 24px 0;">
  <tr>
    <td width="25%" style="text-align: center; padding: 16px;">
      <p style="margin: 0; font-size: 24px; font-weight: 700; color: {{brandColor}};">{{stats.totalTime}}</p>
      <p style="margin: 4px 0 0 0; font-size: 12px; color: #71717a;">{{t 'progress_report.time_learning'}}</p>
    </td>
    <td width="25%" style="text-align: center; padding: 16px;">
      <p style="margin: 0; font-size: 24px; font-weight: 700; color: {{brandColor}};">{{stats.lessonsCompleted}}</p>
      <p style="margin: 4px 0 0 0; font-size: 12px; color: #71717a;">{{t 'progress_report.lessons'}}</p>
    </td>
    <td width="25%" style="text-align: center; padding: 16px;">
      <p style="margin: 0; font-size: 24px; font-weight: 700; color: {{brandColor}};">{{stats.averageScore}}%</p>
      <p style="margin: 4px 0 0 0; font-size: 12px; color: #71717a;">{{t 'progress_report.avg_score'}}</p>
    </td>
    <td width="25%" style="text-align: center; padding: 16px;">
      <p style="margin: 0; font-size: 24px; font-weight: 700; color: {{brandColor}};">{{stats.streak}}</p>
      <p style="margin: 4px 0 0 0; font-size: 12px; color: #71717a;">{{t 'progress_report.day_streak'}}</p>
    </td>
  </tr>
</table>

<!-- Subject Progress -->
<h2>{{t 'progress_report.by_subject'}}</h2>

{{#each subjects}}
<div style="margin: 16px 0; padding: 16px; background-color: #f8fafc; border-radius: 8px;">
  <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
    <tr>
      <td>
        <p style="margin: 0; font-weight: 600; color: #18181b;">{{name}}</p>
      </td>
      <td style="text-align: right;">
        <span style="font-weight: 600; color: {{../brandColor}};">{{progress}}%</span>
      </td>
    </tr>
    <tr>
      <td colspan="2" style="padding-top: 8px;">
        <div style="background-color: #e4e4e7; border-radius: 4px; height: 8px; overflow: hidden;">
          <div style="background-color: {{../brandColor}}; width: {{progress}}%; height: 100%; border-radius: 4px;"></div>
        </div>
      </td>
    </tr>
    {{#if highlights}}
    <tr>
      <td colspan="2" style="padding-top: 8px;">
        <p style="margin: 0; font-size: 13px; color: #52525b;">
          {{#each highlights}}
          <span style="display: inline-block; margin-right: 8px;">âœ“ {{this}}</span>
          {{/each}}
        </p>
      </td>
    </tr>
    {{/if}}
  </table>
</div>
{{/each}}

{{#if standards}}
<!-- Standards Progress -->
<h2 style="margin-top: 32px;">{{t 'progress_report.standards_title'}}</h2>

<table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%" style="margin: 16px 0;">
  {{#each standards}}
  <tr>
    <td style="padding: 12px 0; border-bottom: 1px solid #e4e4e7;">
      <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
        <tr>
          <td width="60">
            <span style="display: inline-block; width: 48px; height: 48px; border-radius: 50%; text-align: center; line-height: 48px; font-weight: 600; font-size: 14px;
              {{#if (eq status 'mastered')}}background-color: #dcfce7; color: #166534;{{/if}}
              {{#if (eq status 'proficient')}}background-color: #dbeafe; color: #1e40af;{{/if}}
              {{#if (eq status 'developing')}}background-color: #fef3c7; color: #92400e;{{/if}}
              {{#if (eq status 'beginning')}}background-color: #fee2e2; color: #991b1b;{{/if}}
            ">
              {{code}}
            </span>
          </td>
          <td style="padding-left: 12px;">
            <p style="margin: 0; font-weight: 500; color: #18181b;">{{name}}</p>
            <p style="margin: 4px 0 0 0; font-size: 13px; color: #71717a;">{{description}}</p>
          </td>
          <td style="text-align: right; white-space: nowrap;">
            <span style="display: inline-block; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 500;
              {{#if (eq status 'mastered')}}background-color: #dcfce7; color: #166534;{{/if}}
              {{#if (eq status 'proficient')}}background-color: #dbeafe; color: #1e40af;{{/if}}
              {{#if (eq status 'developing')}}background-color: #fef3c7; color: #92400e;{{/if}}
              {{#if (eq status 'beginning')}}background-color: #fee2e2; color: #991b1b;{{/if}}
            ">
              {{statusLabel}}
            </span>
          </td>
        </tr>
      </table>
    </td>
  </tr>
  {{/each}}
</table>
{{/if}}

{{#if iepGoals}}
<!-- IEP Goals Progress (if applicable) -->
<div style="background-color: #eff6ff; border-radius: 12px; padding: 20px; margin: 24px 0;">
  <h2 style="margin: 0 0 16px 0; color: #1e40af;">ðŸ“‹ {{t 'progress_report.iep_goals'}}</h2>
  
  {{#each iepGoals}}
  <div style="padding: 12px 0; {{#unless @last}}border-bottom: 1px solid #bfdbfe;{{/unless}}">
    <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
      <tr>
        <td>
          <p style="margin: 0; font-weight: 500; color: #1e40af;">{{goalName}}</p>
        </td>
        <td style="text-align: right;">
          <span style="font-weight: 600; color: #1e40af;">{{progress}}%</span>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="padding-top: 8px;">
          <div style="background-color: #bfdbfe; border-radius: 4px; height: 6px; overflow: hidden;">
            <div style="background-color: #2563eb; width: {{progress}}%; height: 100%; border-radius: 4px;"></div>
          </div>
        </td>
      </tr>
      <tr>
        <td colspan="2" style="padding-top: 4px;">
          <p style="margin: 0; font-size: 12px; color: #3b82f6;">
            {{t 'progress_report.target'}}: {{targetDate}}
          </p>
        </td>
      </tr>
    </table>
  </div>
  {{/each}}
</div>
{{/if}}

{{#if recommendations}}
<!-- Recommendations -->
<h2 style="margin-top: 32px;">{{t 'progress_report.recommendations'}}</h2>

<div style="background-color: #f8fafc; border-radius: 8px; padding: 16px;">
  {{#each recommendations}}
  <div style="padding: 8px 0; {{#unless @last}}border-bottom: 1px solid #e2e8f0;{{/unless}}">
    <p style="margin: 0;"><span style="font-size: 18px; margin-right: 8px;">{{icon}}</span> {{text}}</p>
  </div>
  {{/each}}
</div>
{{/if}}

<!-- CTA -->
<div style="text-align: center; margin: 32px 0;">
  <a href="{{fullReportUrl}}" class="btn-primary" style="background-color: {{brandColor}}; color: #ffffff; text-decoration: none; padding: 14px 32px; border-radius: 8px; font-weight: 600; display: inline-block;">
    {{t 'progress_report.view_full_report'}}
  </a>
</div>

<p style="text-align: center; color: #71717a; font-size: 14px;">
  {{t 'progress_report.questions'}}
  <a href="mailto:{{teacherEmail}}" style="color: {{brandColor}};">{{t 'progress_report.contact_teacher'}}</a>
</p>

{{/layouts/base}}
