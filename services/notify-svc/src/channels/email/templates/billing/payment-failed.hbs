{{!-- Payment Failed Email Template --}}
{{!-- Sent when a payment attempt fails --}}

{{#> layouts/base}}

<div style="text-align: center; margin-bottom: 24px;">
  <div style="width: 64px; height: 64px; background-color: #fee2e2; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; margin: 0 auto;">
    <span style="font-size: 28px;">⚠️</span>
  </div>
</div>

<h1 style="text-align: center; color: #dc2626;">{{t 'payment_failed.title'}}</h1>

<p style="text-align: center; font-size: 18px;">
  {{t 'payment_failed.greeting' name=userName}}
</p>

<p style="text-align: center; color: #52525b;">
  {{t 'payment_failed.intro'}}
</p>

<!-- Failed Payment Details -->
<div style="background-color: #fef2f2; border: 1px solid #fecaca; border-radius: 12px; padding: 24px; margin: 24px 0;">
  <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
    <tr>
      <td>
        <p style="margin: 0; font-size: 14px; color: #991b1b;">{{t 'payment_failed.amount'}}</p>
        <p style="margin: 4px 0 0 0; font-size: 24px; font-weight: 700; color: #dc2626;">{{amount}}</p>
      </td>
      <td style="text-align: right;">
        <p style="margin: 0; font-size: 14px; color: #991b1b;">{{t 'payment_failed.attempted'}}</p>
        <p style="margin: 4px 0 0 0; font-weight: 500; color: #dc2626;">{{attemptDate}}</p>
      </td>
    </tr>
  </table>
  
  <div style="margin-top: 16px; padding-top: 16px; border-top: 1px solid #fecaca;">
    <p style="margin: 0; font-size: 14px; color: #991b1b;">{{t 'payment_failed.reason'}}</p>
    <p style="margin: 4px 0 0 0; color: #dc2626;">{{failureReason}}</p>
  </div>
</div>

<!-- Payment Method -->
<div style="background-color: #f8fafc; border-radius: 8px; padding: 16px; margin: 24px 0;">
  <table role="presentation" cellspacing="0" cellpadding="0" border="0" width="100%">
    <tr>
      <td>
        <p style="margin: 0; font-size: 14px; color: #64748b;">{{t 'payment_failed.payment_method'}}</p>
        <p style="margin: 4px 0 0 0; font-weight: 500; color: #1e293b;">
          {{paymentMethod.brand}} •••• {{paymentMethod.last4}}
          {{#if paymentMethod.expiry}}
          <span style="color: #dc2626; font-size: 13px;"> ({{t 'payment_failed.expires'}} {{paymentMethod.expiry}})</span>
          {{/if}}
        </p>
      </td>
    </tr>
  </table>
</div>

<!-- What to do -->
<h2>{{t 'payment_failed.what_to_do'}}</h2>

<div style="background-color: #f8fafc; border-radius: 8px; padding: 20px; margin: 24px 0;">
  <ol style="margin: 0; padding-left: 20px; color: #52525b;">
    <li style="padding: 8px 0;">
      <strong>{{t 'payment_failed.step1_title'}}</strong><br>
      <span style="font-size: 14px;">{{t 'payment_failed.step1_desc'}}</span>
    </li>
    <li style="padding: 8px 0;">
      <strong>{{t 'payment_failed.step2_title'}}</strong><br>
      <span style="font-size: 14px;">{{t 'payment_failed.step2_desc'}}</span>
    </li>
    <li style="padding: 8px 0;">
      <strong>{{t 'payment_failed.step3_title'}}</strong><br>
      <span style="font-size: 14px;">{{t 'payment_failed.step3_desc'}}</span>
    </li>
  </ol>
</div>

<!-- Urgency notice -->
{{#if gracePeriodEnd}}
<div style="background-color: #fef3c7; border-left: 4px solid #f59e0b; border-radius: 0 8px 8px 0; padding: 16px; margin: 24px 0;">
  <p style="margin: 0; color: #92400e;">
    <strong>⏱️ {{t 'payment_failed.grace_period'}}</strong><br>
    {{t 'payment_failed.grace_period_message' date=gracePeriodEnd}}
  </p>
</div>
{{/if}}

{{#if retryScheduled}}
<div style="background-color: #eff6ff; border-radius: 8px; padding: 16px; margin: 24px 0;">
  <p style="margin: 0; color: #3b82f6;">
    ℹ️ {{t 'payment_failed.retry_scheduled' date=retryDate}}
  </p>
</div>
{{/if}}

<!-- CTA -->
<div style="text-align: center; margin: 32px 0;">
  <a href="{{updatePaymentUrl}}" class="btn-primary" style="background-color: {{brandColor}}; color: #ffffff; text-decoration: none; padding: 14px 32px; border-radius: 8px; font-weight: 600; display: inline-block;">
    {{t 'payment_failed.update_payment'}}
  </a>
</div>

<div style="text-align: center; margin: 16px 0;">
  <a href="{{retryPaymentUrl}}" style="color: {{brandColor}}; text-decoration: underline; font-weight: 500;">
    {{t 'payment_failed.retry_now'}}
  </a>
</div>

<hr style="border: none; border-top: 1px solid #e4e4e7; margin: 32px 0;">

<!-- Impact on service -->
{{#if serviceImpact}}
<div style="margin: 24px 0;">
  <p style="margin: 0 0 12px 0; font-weight: 600; color: #18181b;">
    {{t 'payment_failed.service_impact'}}
  </p>
  <ul style="margin: 0; padding-left: 20px; color: #52525b; font-size: 14px;">
    {{#each serviceImpact}}
    <li style="padding: 4px 0;">{{this}}</li>
    {{/each}}
  </ul>
</div>
{{/if}}

<p style="text-align: center; color: #71717a; font-size: 14px;">
  {{t 'payment_failed.need_help'}}<br>
  <a href="mailto:{{supportEmail}}" style="color: {{brandColor}};">{{supportEmail}}</a>
  {{#if supportPhone}}
  <br>{{t 'payment_failed.or_call'}} <a href="tel:{{supportPhone}}" style="color: {{brandColor}};">{{supportPhone}}</a>
  {{/if}}
</p>

{{/layouts/base}}
