/**
 * I18n Service
 *
 * Internationalization service for multi-language support.
 */

import { Injectable } from '@nestjs/common';
import { logger } from '@aivo/ts-observability';

// Translation dictionaries
const translations: Record<string, Record<string, string>> = {
  en: {
    'digest.weekly.title': 'Weekly Learning Summary',
    'digest.weekly.subject': 'Weekly Progress Report - {{weekStart}}',
    'digest.weekly.greeting': 'Hi {{name}}! Here\'s how your child did this week.',
    'digest.weekly.viewDashboard': 'View Full Dashboard',
    'digest.weekly.highlights': 'This Week\'s Highlights',
    'digest.weekly.achievements': 'Achievements Earned',
    'digest.weekly.teacherNotes': 'Notes from Teachers',
    'digest.weekly.upcoming': 'Upcoming Assignments',
    'digest.weekly.stats.minutes': 'Minutes',
    'digest.weekly.stats.lessons': 'Lessons',
    'digest.weekly.stats.avgScore': 'Avg Score',
    'digest.weekly.moreThanlastWeek': 'more than last week',
    'digest.weekly.lessThanlastWeek': 'less than last week',
    'digest.weekly.footer.receivingBecause': 'You\'re receiving this because you\'re signed up for weekly progress updates.',
    'digest.weekly.footer.managePreferences': 'Manage Preferences',
    'digest.weekly.footer.unsubscribe': 'Unsubscribe',
    'email.invite.subject': 'You\'re invited to track {{studentName}}\'s learning progress',
    'email.invite.greeting': 'Hi {{parentName}},',
    'email.invite.body': 'A teacher has invited you to join AIVO and track your child\'s learning progress.',
    'email.invite.cta': 'Accept Invitation',
    'email.invite.expires': 'This invitation expires on {{expiresAt}}.',
    'email.verify.subject': 'Verify your email address',
    'email.verify.greeting': 'Hi {{name}},',
    'email.verify.body': 'Please verify your email address to complete your account setup.',
    'email.verify.cta': 'Verify Email',
  },
  es: {
    'digest.weekly.title': 'Resumen Semanal de Aprendizaje',
    'digest.weekly.subject': 'Informe de Progreso Semanal - {{weekStart}}',
    'digest.weekly.greeting': '¡Hola {{name}}! Así le fue a tu hijo esta semana.',
    'digest.weekly.viewDashboard': 'Ver Panel Completo',
    'digest.weekly.highlights': 'Destacados de Esta Semana',
    'digest.weekly.achievements': 'Logros Obtenidos',
    'digest.weekly.teacherNotes': 'Notas de los Maestros',
    'digest.weekly.upcoming': 'Próximas Tareas',
    'digest.weekly.stats.minutes': 'Minutos',
    'digest.weekly.stats.lessons': 'Lecciones',
    'digest.weekly.stats.avgScore': 'Promedio',
    'digest.weekly.moreThanlastWeek': 'más que la semana pasada',
    'digest.weekly.lessThanlastWeek': 'menos que la semana pasada',
    'digest.weekly.footer.receivingBecause': 'Recibes esto porque estás suscrito a actualizaciones semanales de progreso.',
    'digest.weekly.footer.managePreferences': 'Gestionar Preferencias',
    'digest.weekly.footer.unsubscribe': 'Cancelar Suscripción',
    'email.invite.subject': 'Estás invitado a seguir el progreso de aprendizaje de {{studentName}}',
    'email.invite.greeting': 'Hola {{parentName}},',
    'email.invite.body': 'Un maestro te ha invitado a unirte a AIVO y seguir el progreso de aprendizaje de tu hijo.',
    'email.invite.cta': 'Aceptar Invitación',
    'email.invite.expires': 'Esta invitación expira el {{expiresAt}}.',
    'email.verify.subject': 'Verifica tu dirección de correo electrónico',
    'email.verify.greeting': 'Hola {{name}},',
    'email.verify.body': 'Por favor verifica tu dirección de correo electrónico para completar la configuración de tu cuenta.',
    'email.verify.cta': 'Verificar Correo',
  },
  fr: {
    'digest.weekly.title': 'Résumé Hebdomadaire d\'Apprentissage',
    'digest.weekly.subject': 'Rapport de Progrès Hebdomadaire - {{weekStart}}',
    'digest.weekly.greeting': 'Bonjour {{name}} ! Voici les progrès de votre enfant cette semaine.',
    'digest.weekly.viewDashboard': 'Voir le Tableau de Bord',
    'digest.weekly.highlights': 'Points Forts de la Semaine',
    'digest.weekly.achievements': 'Réalisations',
    'digest.weekly.teacherNotes': 'Notes des Enseignants',
    'digest.weekly.upcoming': 'Devoirs à Venir',
    'digest.weekly.stats.minutes': 'Minutes',
    'digest.weekly.stats.lessons': 'Leçons',
    'digest.weekly.stats.avgScore': 'Moyenne',
    'digest.weekly.moreThanlastWeek': 'de plus que la semaine dernière',
    'digest.weekly.lessThanlastWeek': 'de moins que la semaine dernière',
    'digest.weekly.footer.receivingBecause': 'Vous recevez ceci car vous êtes inscrit aux mises à jour hebdomadaires.',
    'digest.weekly.footer.managePreferences': 'Gérer les Préférences',
    'digest.weekly.footer.unsubscribe': 'Se Désabonner',
    'email.invite.subject': 'Vous êtes invité à suivre les progrès de {{studentName}}',
    'email.invite.greeting': 'Bonjour {{parentName}},',
    'email.invite.body': 'Un enseignant vous a invité à rejoindre AIVO et suivre les progrès d\'apprentissage de votre enfant.',
    'email.invite.cta': 'Accepter l\'Invitation',
    'email.invite.expires': 'Cette invitation expire le {{expiresAt}}.',
    'email.verify.subject': 'Vérifiez votre adresse e-mail',
    'email.verify.greeting': 'Bonjour {{name}},',
    'email.verify.body': 'Veuillez vérifier votre adresse e-mail pour terminer la configuration de votre compte.',
    'email.verify.cta': 'Vérifier l\'E-mail',
  },
  de: {
    'digest.weekly.title': 'Wöchentliche Lernzusammenfassung',
    'digest.weekly.subject': 'Wöchentlicher Fortschrittsbericht - {{weekStart}}',
    'digest.weekly.greeting': 'Hallo {{name}}! So hat Ihr Kind diese Woche abgeschnitten.',
    'digest.weekly.viewDashboard': 'Vollständiges Dashboard Anzeigen',
    'digest.weekly.highlights': 'Highlights dieser Woche',
    'digest.weekly.achievements': 'Errungenschaften',
    'digest.weekly.teacherNotes': 'Lehrernotizen',
    'digest.weekly.upcoming': 'Kommende Aufgaben',
    'digest.weekly.stats.minutes': 'Minuten',
    'digest.weekly.stats.lessons': 'Lektionen',
    'digest.weekly.stats.avgScore': 'Durchschnitt',
    'digest.weekly.moreThanlastWeek': 'mehr als letzte Woche',
    'digest.weekly.lessThanlastWeek': 'weniger als letzte Woche',
    'digest.weekly.footer.receivingBecause': 'Sie erhalten diese E-Mail, weil Sie wöchentliche Updates abonniert haben.',
    'digest.weekly.footer.managePreferences': 'Einstellungen Verwalten',
    'digest.weekly.footer.unsubscribe': 'Abmelden',
    'email.invite.subject': 'Sie sind eingeladen, {{studentName}}s Lernfortschritt zu verfolgen',
    'email.invite.greeting': 'Hallo {{parentName}},',
    'email.invite.body': 'Ein Lehrer hat Sie eingeladen, AIVO beizutreten und den Lernfortschritt Ihres Kindes zu verfolgen.',
    'email.invite.cta': 'Einladung Annehmen',
    'email.invite.expires': 'Diese Einladung läuft am {{expiresAt}} ab.',
    'email.verify.subject': 'Bestätigen Sie Ihre E-Mail-Adresse',
    'email.verify.greeting': 'Hallo {{name}},',
    'email.verify.body': 'Bitte bestätigen Sie Ihre E-Mail-Adresse, um die Kontoeinrichtung abzuschließen.',
    'email.verify.cta': 'E-Mail Bestätigen',
  },
  pt: {
    'digest.weekly.title': 'Resumo Semanal de Aprendizado',
    'digest.weekly.subject': 'Relatório de Progresso Semanal - {{weekStart}}',
    'digest.weekly.greeting': 'Olá {{name}}! Veja como seu filho foi esta semana.',
    'digest.weekly.viewDashboard': 'Ver Painel Completo',
    'digest.weekly.highlights': 'Destaques da Semana',
    'digest.weekly.achievements': 'Conquistas',
    'digest.weekly.teacherNotes': 'Notas dos Professores',
    'digest.weekly.upcoming': 'Próximas Tarefas',
    'digest.weekly.stats.minutes': 'Minutos',
    'digest.weekly.stats.lessons': 'Lições',
    'digest.weekly.stats.avgScore': 'Média',
    'digest.weekly.moreThanlastWeek': 'mais que semana passada',
    'digest.weekly.lessThanlastWeek': 'menos que semana passada',
    'digest.weekly.footer.receivingBecause': 'Você recebe isso porque está inscrito para atualizações semanais.',
    'digest.weekly.footer.managePreferences': 'Gerenciar Preferências',
    'digest.weekly.footer.unsubscribe': 'Cancelar Inscrição',
    'email.invite.subject': 'Você foi convidado a acompanhar o progresso de {{studentName}}',
    'email.invite.greeting': 'Olá {{parentName}},',
    'email.invite.body': 'Um professor convidou você a se juntar ao AIVO e acompanhar o progresso de aprendizado do seu filho.',
    'email.invite.cta': 'Aceitar Convite',
    'email.invite.expires': 'Este convite expira em {{expiresAt}}.',
    'email.verify.subject': 'Verifique seu endereço de e-mail',
    'email.verify.greeting': 'Olá {{name}},',
    'email.verify.body': 'Por favor, verifique seu endereço de e-mail para concluir a configuração da sua conta.',
    'email.verify.cta': 'Verificar E-mail',
  },
  zh: {
    'digest.weekly.title': '每周学习总结',
    'digest.weekly.subject': '每周进度报告 - {{weekStart}}',
    'digest.weekly.greeting': '您好 {{name}}！以下是您孩子本周的学习情况。',
    'digest.weekly.viewDashboard': '查看完整仪表板',
    'digest.weekly.highlights': '本周亮点',
    'digest.weekly.achievements': '获得的成就',
    'digest.weekly.teacherNotes': '教师备注',
    'digest.weekly.upcoming': '即将到来的作业',
    'digest.weekly.stats.minutes': '分钟',
    'digest.weekly.stats.lessons': '课程',
    'digest.weekly.stats.avgScore': '平均分',
    'digest.weekly.moreThanlastWeek': '比上周多',
    'digest.weekly.lessThanlastWeek': '比上周少',
    'digest.weekly.footer.receivingBecause': '您收到此邮件是因为您订阅了每周进度更新。',
    'digest.weekly.footer.managePreferences': '管理偏好设置',
    'digest.weekly.footer.unsubscribe': '取消订阅',
    'email.invite.subject': '您被邀请跟踪{{studentName}}的学习进度',
    'email.invite.greeting': '您好 {{parentName}}，',
    'email.invite.body': '一位老师邀请您加入AIVO并跟踪您孩子的学习进度。',
    'email.invite.cta': '接受邀请',
    'email.invite.expires': '此邀请将于{{expiresAt}}到期。',
    'email.verify.subject': '验证您的电子邮件地址',
    'email.verify.greeting': '您好 {{name}}，',
    'email.verify.body': '请验证您的电子邮件地址以完成账户设置。',
    'email.verify.cta': '验证邮箱',
  },
  ja: {
    'digest.weekly.title': '週間学習サマリー',
    'digest.weekly.subject': '週間進捗レポート - {{weekStart}}',
    'digest.weekly.greeting': 'こんにちは {{name}}さん！今週のお子様の学習状況です。',
    'digest.weekly.viewDashboard': 'ダッシュボードを見る',
    'digest.weekly.highlights': '今週のハイライト',
    'digest.weekly.achievements': '獲得した実績',
    'digest.weekly.teacherNotes': '先生からのメモ',
    'digest.weekly.upcoming': '今後の課題',
    'digest.weekly.stats.minutes': '分',
    'digest.weekly.stats.lessons': 'レッスン',
    'digest.weekly.stats.avgScore': '平均点',
    'digest.weekly.moreThanlastWeek': '先週より多い',
    'digest.weekly.lessThanlastWeek': '先週より少ない',
    'digest.weekly.footer.receivingBecause': '週間進捗更新にご登録いただいているため、このメールをお送りしています。',
    'digest.weekly.footer.managePreferences': '設定を管理',
    'digest.weekly.footer.unsubscribe': '配信停止',
    'email.invite.subject': '{{studentName}}の学習進捗を追跡するよう招待されました',
    'email.invite.greeting': 'こんにちは {{parentName}}さん、',
    'email.invite.body': '先生がAIVOに参加してお子様の学習進捗を追跡するよう招待しました。',
    'email.invite.cta': '招待を受ける',
    'email.invite.expires': 'この招待は{{expiresAt}}に期限切れになります。',
    'email.verify.subject': 'メールアドレスを確認してください',
    'email.verify.greeting': 'こんにちは {{name}}さん、',
    'email.verify.body': 'アカウント設定を完了するためにメールアドレスを確認してください。',
    'email.verify.cta': 'メールを確認',
  },
  ko: {
    'digest.weekly.title': '주간 학습 요약',
    'digest.weekly.subject': '주간 진행 보고서 - {{weekStart}}',
    'digest.weekly.greeting': '안녕하세요 {{name}}님! 이번 주 자녀의 학습 현황입니다.',
    'digest.weekly.viewDashboard': '전체 대시보드 보기',
    'digest.weekly.highlights': '이번 주 하이라이트',
    'digest.weekly.achievements': '획득한 성과',
    'digest.weekly.teacherNotes': '선생님 메모',
    'digest.weekly.upcoming': '예정된 과제',
    'digest.weekly.stats.minutes': '분',
    'digest.weekly.stats.lessons': '레슨',
    'digest.weekly.stats.avgScore': '평균 점수',
    'digest.weekly.moreThanlastWeek': '지난주보다 증가',
    'digest.weekly.lessThanlastWeek': '지난주보다 감소',
    'digest.weekly.footer.receivingBecause': '주간 진행 업데이트를 구독하셨기 때문에 이 이메일을 받으셨습니다.',
    'digest.weekly.footer.managePreferences': '환경설정 관리',
    'digest.weekly.footer.unsubscribe': '구독 취소',
    'email.invite.subject': '{{studentName}}의 학습 진행 상황을 추적하도록 초대되었습니다',
    'email.invite.greeting': '안녕하세요 {{parentName}}님,',
    'email.invite.body': '선생님이 AIVO에 가입하여 자녀의 학습 진행 상황을 추적하도록 초대했습니다.',
    'email.invite.cta': '초대 수락',
    'email.invite.expires': '이 초대는 {{expiresAt}}에 만료됩니다.',
    'email.verify.subject': '이메일 주소를 확인하세요',
    'email.verify.greeting': '안녕하세요 {{name}}님,',
    'email.verify.body': '계정 설정을 완료하려면 이메일 주소를 확인하세요.',
    'email.verify.cta': '이메일 확인',
  },
  ar: {
    'digest.weekly.title': 'ملخص التعلم الأسبوعي',
    'digest.weekly.subject': 'تقرير التقدم الأسبوعي - {{weekStart}}',
    'digest.weekly.greeting': 'مرحباً {{name}}! إليك أداء طفلك هذا الأسبوع.',
    'digest.weekly.viewDashboard': 'عرض لوحة القيادة الكاملة',
    'digest.weekly.highlights': 'أبرز أحداث هذا الأسبوع',
    'digest.weekly.achievements': 'الإنجازات المحققة',
    'digest.weekly.teacherNotes': 'ملاحظات المعلمين',
    'digest.weekly.upcoming': 'الواجبات القادمة',
    'digest.weekly.stats.minutes': 'دقيقة',
    'digest.weekly.stats.lessons': 'دروس',
    'digest.weekly.stats.avgScore': 'المعدل',
    'digest.weekly.moreThanlastWeek': 'أكثر من الأسبوع الماضي',
    'digest.weekly.lessThanlastWeek': 'أقل من الأسبوع الماضي',
    'digest.weekly.footer.receivingBecause': 'تتلقى هذا البريد لأنك مشترك في تحديثات التقدم الأسبوعية.',
    'digest.weekly.footer.managePreferences': 'إدارة التفضيلات',
    'digest.weekly.footer.unsubscribe': 'إلغاء الاشتراك',
    'email.invite.subject': 'أنت مدعو لتتبع تقدم تعلم {{studentName}}',
    'email.invite.greeting': 'مرحباً {{parentName}}،',
    'email.invite.body': 'دعاك معلم للانضمام إلى AIVO وتتبع تقدم تعلم طفلك.',
    'email.invite.cta': 'قبول الدعوة',
    'email.invite.expires': 'تنتهي صلاحية هذه الدعوة في {{expiresAt}}.',
    'email.verify.subject': 'تحقق من عنوان بريدك الإلكتروني',
    'email.verify.greeting': 'مرحباً {{name}}،',
    'email.verify.body': 'يرجى التحقق من عنوان بريدك الإلكتروني لإكمال إعداد حسابك.',
    'email.verify.cta': 'تحقق من البريد الإلكتروني',
  },
  hi: {
    'digest.weekly.title': 'साप्ताहिक सीखने का सारांश',
    'digest.weekly.subject': 'साप्ताहिक प्रगति रिपोर्ट - {{weekStart}}',
    'digest.weekly.greeting': 'नमस्ते {{name}}! इस सप्ताह आपके बच्चे की प्रगति देखें।',
    'digest.weekly.viewDashboard': 'पूर्ण डैशबोर्ड देखें',
    'digest.weekly.highlights': 'इस सप्ताह की मुख्य बातें',
    'digest.weekly.achievements': 'प्राप्त उपलब्धियां',
    'digest.weekly.teacherNotes': 'शिक्षकों की टिप्पणियां',
    'digest.weekly.upcoming': 'आगामी कार्य',
    'digest.weekly.stats.minutes': 'मिनट',
    'digest.weekly.stats.lessons': 'पाठ',
    'digest.weekly.stats.avgScore': 'औसत अंक',
    'digest.weekly.moreThanlastWeek': 'पिछले सप्ताह से अधिक',
    'digest.weekly.lessThanlastWeek': 'पिछले सप्ताह से कम',
    'digest.weekly.footer.receivingBecause': 'आप यह इसलिए प्राप्त कर रहे हैं क्योंकि आपने साप्ताहिक अपडेट के लिए सब्सक्राइब किया है।',
    'digest.weekly.footer.managePreferences': 'प्राथमिकताएं प्रबंधित करें',
    'digest.weekly.footer.unsubscribe': 'सदस्यता रद्द करें',
    'email.invite.subject': 'आपको {{studentName}} की सीखने की प्रगति ट्रैक करने के लिए आमंत्रित किया गया है',
    'email.invite.greeting': 'नमस्ते {{parentName}},',
    'email.invite.body': 'एक शिक्षक ने आपको AIVO से जुड़ने और अपने बच्चे की सीखने की प्रगति को ट्रैक करने के लिए आमंत्रित किया है।',
    'email.invite.cta': 'आमंत्रण स्वीकार करें',
    'email.invite.expires': 'यह आमंत्रण {{expiresAt}} को समाप्त होगा।',
    'email.verify.subject': 'अपना ईमेल पता सत्यापित करें',
    'email.verify.greeting': 'नमस्ते {{name}},',
    'email.verify.body': 'अपना खाता सेटअप पूरा करने के लिए कृपया अपना ईमेल पता सत्यापित करें।',
    'email.verify.cta': 'ईमेल सत्यापित करें',
  },
};

@Injectable()
export class I18nService {
  /**
   * Translate a key with optional interpolation
   */
  t(key: string, language: string, args?: Record<string, unknown>): string {
    const lang = translations[language] || translations['en'];
    let text = lang[key] || translations['en'][key] || key;

    // Interpolate arguments
    if (args) {
      for (const [argKey, argValue] of Object.entries(args)) {
        text = text.replace(new RegExp(`{{${argKey}}}`, 'g'), String(argValue));
      }
    }

    return text;
  }

  /**
   * Get all supported languages
   */
  getSupportedLanguages(): string[] {
    return Object.keys(translations);
  }

  /**
   * Check if a language is supported
   */
  isSupported(language: string): boolean {
    return language in translations;
  }
}
