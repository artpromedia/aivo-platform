# =============================================================================
# NATS JetStream Configuration for AIVO Event Streaming
# =============================================================================
#
# This config is shared across all cluster nodes.
# Node-specific settings are passed via command line arguments.

# -----------------------------------------------------------------------------
# JetStream Configuration
# -----------------------------------------------------------------------------
jetstream {
  # Storage directory (mounted via docker volume)
  store_dir: "/data/jetstream"
  
  # Memory limits per node (adjust for production)
  max_memory_store: 256MB
  
  # Disk storage limits per node
  max_file_store: 1GB
  
  # Domain for multi-cluster setups (optional)
  # domain: "aivo"
}

# -----------------------------------------------------------------------------
# Server Limits
# -----------------------------------------------------------------------------
max_connections: 1000
max_payload: 1MB
max_pending: 64MB

# Connection timeout for slow clients
write_deadline: "10s"

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
debug: false
trace: false
logtime: true
log_file: "/data/nats.log"

# Log rotation (available in NATS 2.10+)
logfile_size_limit: 50MB

# -----------------------------------------------------------------------------
# Monitoring
# -----------------------------------------------------------------------------
http_port: 8222

# Enable system account for monitoring tools
system_account: SYS

# Accounts for multi-tenant isolation (production)
accounts: {
  # System account for internal monitoring
  SYS: {
    users: [
      { user: "sys", password: "$NATS_SYS_PASSWORD" }
    ]
  }
  
  # Default account for development
  AIVO: {
    jetstream: enabled
    users: [
      { user: "aivo", password: "$NATS_AIVO_PASSWORD" }
    ]
  }
}

# For local development, allow anonymous connections
# Remove this block and enable accounts for production
no_auth_user: "aivo"

# -----------------------------------------------------------------------------
# Cluster Configuration (overridden by CLI but defaults here)
# -----------------------------------------------------------------------------
cluster {
  name: "aivo-nats"
  
  # Cluster route timeout
  connect_retries: 30
  
  # Pool size for cluster routes
  pool_size: 3
}

# -----------------------------------------------------------------------------
# Leaf Node Support (for edge deployments)
# -----------------------------------------------------------------------------
leafnodes {
  port: 7422
  # Uncomment to allow remote leaf connections
  # no_advertise: true
}
