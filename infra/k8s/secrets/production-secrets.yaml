# AIVO Platform - Production Secrets Template
# 
# ⚠️  DO NOT store actual secrets in this file!
# 
# For production, use one of these approaches:
# 1. Google Secret Manager with Workload Identity
# 2. HashiCorp Vault with Kubernetes auth
# 3. Sealed Secrets (Bitnami)
# 4. External Secrets Operator
#
# This template shows the structure of required secrets.

apiVersion: v1
kind: Namespace
metadata:
  name: aivo-prod
  labels:
    app.kubernetes.io/part-of: aivo-platform
    environment: production

---
# Example using External Secrets Operator with Google Secret Manager
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: database-credentials
  namespace: aivo-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcp-secret-store
    kind: ClusterSecretStore
  target:
    name: database-credentials
    creationPolicy: Owner
  data:
    - secretKey: AUTH_DATABASE_URL
      remoteRef:
        key: aivo-prod-auth-database-url
    - secretKey: TENANT_DATABASE_URL
      remoteRef:
        key: aivo-prod-tenant-database-url
    - secretKey: CONTENT_DATABASE_URL
      remoteRef:
        key: aivo-prod-content-database-url
    - secretKey: SESSION_DATABASE_URL
      remoteRef:
        key: aivo-prod-session-database-url
    - secretKey: ASSESSMENT_DATABASE_URL
      remoteRef:
        key: aivo-prod-assessment-database-url
    - secretKey: ANALYTICS_DATABASE_URL
      remoteRef:
        key: aivo-prod-analytics-database-url
    - secretKey: ENGAGEMENT_DATABASE_URL
      remoteRef:
        key: aivo-prod-engagement-database-url
    - secretKey: PERSONALIZATION_DATABASE_URL
      remoteRef:
        key: aivo-prod-personalization-database-url
    - secretKey: BASELINE_DATABASE_URL
      remoteRef:
        key: aivo-prod-baseline-database-url
    - secretKey: BILLING_DATABASE_URL
      remoteRef:
        key: aivo-prod-billing-database-url

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: redis-credentials
  namespace: aivo-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcp-secret-store
    kind: ClusterSecretStore
  target:
    name: redis-credentials
    creationPolicy: Owner
  data:
    - secretKey: REDIS_URL
      remoteRef:
        key: aivo-prod-redis-url

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: jwt-keys
  namespace: aivo-prod
spec:
  refreshInterval: 24h
  secretStoreRef:
    name: gcp-secret-store
    kind: ClusterSecretStore
  target:
    name: jwt-keys
    creationPolicy: Owner
  data:
    - secretKey: JWT_KEY_ID
      remoteRef:
        key: aivo-prod-jwt-key-id
    - secretKey: JWT_PRIVATE_KEY
      remoteRef:
        key: aivo-prod-jwt-private-key
    - secretKey: JWT_PUBLIC_KEY
      remoteRef:
        key: aivo-prod-jwt-public-key

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: external-services
  namespace: aivo-prod
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: gcp-secret-store
    kind: ClusterSecretStore
  target:
    name: external-services
    creationPolicy: Owner
  data:
    - secretKey: OPENAI_API_KEY
      remoteRef:
        key: aivo-prod-openai-api-key
    - secretKey: ANTHROPIC_API_KEY
      remoteRef:
        key: aivo-prod-anthropic-api-key
    - secretKey: SENDGRID_API_KEY
      remoteRef:
        key: aivo-prod-sendgrid-api-key
    - secretKey: STRIPE_SECRET_KEY
      remoteRef:
        key: aivo-prod-stripe-secret-key
    - secretKey: STRIPE_WEBHOOK_SECRET
      remoteRef:
        key: aivo-prod-stripe-webhook-secret

---
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: encryption-keys
  namespace: aivo-prod
spec:
  refreshInterval: 24h
  secretStoreRef:
    name: gcp-secret-store
    kind: ClusterSecretStore
  target:
    name: encryption-keys
    creationPolicy: Owner
  data:
    - secretKey: ENCRYPTION_KEY
      remoteRef:
        key: aivo-prod-encryption-key
    - secretKey: SESSION_SECRET
      remoteRef:
        key: aivo-prod-session-secret

---
# ClusterSecretStore configuration for Google Secret Manager
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: gcp-secret-store
spec:
  provider:
    gcpsm:
      projectID: aivo-production
      auth:
        workloadIdentity:
          clusterLocation: us-central1
          clusterName: aivo-prod-cluster
          serviceAccountRef:
            name: external-secrets-sa
            namespace: external-secrets
